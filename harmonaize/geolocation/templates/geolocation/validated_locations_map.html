<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validated Locations Map - GeoValidator</title>
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        .mapboxgl-popup-content {
            padding: 16px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        .validated-marker {
            border-radius: 50%;
            border: 3px solid #22c55e;
            background-color: #10b981;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .validated-marker:hover {
            transform: scale(1.2);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }

        .download-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #10b981;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .map-layer-control {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .layer-button {
            transition: all 0.3s ease;
            border-radius: 8px;
        }

        .layer-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .layer-button.active {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-green-50 to-blue-50 h-screen overflow-hidden">
    <div class="h-screen flex flex-col">
        <!-- Enhanced Header -->
        <header class="bg-white shadow-lg border-b-2 border-green-100 h-16 flex-shrink-0">
            <div class="h-full px-6 flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <div class="w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center">
                            <span class="text-white text-sm font-bold">‚úÖ</span>
                        </div>
                        <h1 class="text-xl font-bold bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent">
                            Validated Locations Map
                        </h1>
                    </div>
                    
                    <div class="flex items-center space-x-2">
                        <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">
                            {{ total_locations }} Validated Locations
                        </span>
                    </div>
                </div>
                
                <div class="flex items-center space-x-3">
                    <a href="{% url 'geolocation:validation_dashboard' %}" 
                       class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 hover:scale-105">
                        ‚Üê Back to Dashboard
                    </a>
                </div>
            </div>
        </header>

        <!-- Map Container -->
        <div class="flex-1 relative">
            <div id="map" class="w-full h-full"></div>
            
            <!-- Map Layer Control -->
            <div class="absolute top-4 left-4 map-layer-control p-4 text-sm">
                <h4 class="font-bold text-gray-900 mb-3">üó∫Ô∏è Map Layers</h4>
                <div class="grid grid-cols-1 gap-2">
                    <button onclick="changeMapLayer('satellite')" 
                            class="layer-button px-3 py-2 text-left text-gray-700 hover:bg-gray-100 active" 
                            id="satellite-btn">
                        üõ∞Ô∏è Satellite
                    </button>
                    <button onclick="changeMapLayer('streets')" 
                            class="layer-button px-3 py-2 text-left text-gray-700 hover:bg-gray-100" 
                            id="streets-btn">
                        üó∫Ô∏è Streets
                    </button>
                    <button onclick="changeMapLayer('terrain')" 
                            class="layer-button px-3 py-2 text-left text-gray-700 hover:bg-gray-100" 
                            id="terrain-btn">
                        üèîÔ∏è Terrain
                    </button>
                    <button onclick="changeMapLayer('outdoors')" 
                            class="layer-button px-3 py-2 text-left text-gray-700 hover:bg-gray-100" 
                            id="outdoors-btn">
                        üå≤ Outdoors
                    </button>
                </div>
            </div>

            <!-- Download Panel -->
            <div class="absolute top-4 right-4 download-panel p-4 text-sm">
                <h4 class="font-bold text-gray-900 mb-3">üì• Download Map</h4>
                <div class="space-y-2">
                    <button onclick="downloadMap('pdf')" 
                            class="w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 flex items-center justify-center space-x-2">
                        <span>üìÑ</span>
                        <span>Download PDF</span>
                    </button>
                    <button onclick="downloadMap('png')" 
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 flex items-center justify-center space-x-2">
                        <span>üñºÔ∏è</span>
                        <span>Download PNG</span>
                    </button>
                    <button onclick="downloadMap('svg')" 
                            class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 flex items-center justify-center space-x-2">
                        <span>üé®</span>
                        <span>Download SVG</span>
                    </button>
                </div>
                
                <!-- Download Progress -->
                <div id="downloadProgress" class="hidden mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
                    <div class="flex items-center space-x-2">
                        <div class="loading-spinner"></div>
                        <span class="text-sm text-blue-800">Generating download...</span>
                    </div>
                </div>
            </div>

            <!-- Map Info Panel -->
            <div class="absolute bottom-4 left-4 bg-white/90 backdrop-blur-sm rounded-xl shadow-lg p-4 text-sm border border-gray-200">
                <div class="space-y-2">
                    <div class="flex items-center space-x-2">
                        <div class="w-4 h-4 bg-green-500 rounded-full border-2 border-green-300"></div>
                        <span class="font-medium text-gray-700">Validated Locations</span>
                    </div>
                    <div class="text-xs text-gray-500">
                        Total: {{ total_locations }} locations with confirmed coordinates
                    </div>
                </div>
            </div>

            <!-- Statistics Panel -->
            <div class="absolute bottom-4 right-4 bg-white/90 backdrop-blur-sm rounded-xl shadow-lg p-4 text-sm border border-gray-200">
                <h4 class="font-bold text-gray-900 mb-2">üìä Statistics</h4>
                <div class="space-y-1 text-xs">
                    <div class="flex justify-between">
                        <span class="text-gray-600">Validated:</span>
                        <span class="font-bold text-green-600">{{ total_locations }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Map Zoom:</span>
                        <span class="font-bold text-gray-900" id="currentZoom">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Map Center:</span>
                        <span class="font-bold text-gray-900" id="currentCenter">-</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Messages Container -->
    <div id="messageContainer" class="fixed top-20 left-1/2 transform -translate-x-1/2 z-50 space-y-2"></div>

    <script>
        // Initialize map
        mapboxgl.accessToken = '{{ mapbox_token }}';
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/satellite-streets-v11',
            center: [25, -15],
            zoom: 5
        });

        const locationsData = {{ locations_data|safe }};
        let markers = [];
        let currentMapStyle = 'satellite';

        // Map layer styles
        const mapStyles = {
            'satellite': 'mapbox://styles/mapbox/satellite-streets-v11',
            'streets': 'mapbox://styles/mapbox/streets-v11',
            'terrain': 'mapbox://styles/mapbox/outdoors-v11',
            'outdoors': 'mapbox://styles/mapbox/outdoors-v11'
        };

        // Map layer switching
        function changeMapLayer(layerType) {
            if (layerType === currentMapStyle) return;
            
            // Update button states
            document.querySelectorAll('.layer-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`${layerType}-btn`).classList.add('active');
            
            // Change map style
            map.setStyle(mapStyles[layerType]);
            currentMapStyle = layerType;
            
            // Re-add markers after style change
            map.on('styledata', function() {
                setTimeout(() => {
                    addMarkersToMap();
                }, 100);
            });
        }

        // Add markers to map
        function addMarkersToMap() {
            // Clear existing markers
            markers.forEach(marker => marker.remove());
            markers = [];

            if (locationsData.length === 0) {
                showMessage('No validated locations found', 'info');
                return;
            }

            const bounds = new mapboxgl.LngLatBounds();

            locationsData.forEach((location, index) => {
                // Create marker
                const el = document.createElement('div');
                el.className = 'validated-marker';
                el.style.width = '16px';
                el.style.height = '16px';

                // Enhanced popup
                const popupHTML = `
                    <div class="text-sm">
                        <div class="font-bold text-lg mb-2 text-green-800">${location.name}</div>
                        <div class="space-y-2 mb-3">
                            <div class="bg-green-50 rounded p-2">
                                <div class="text-xs text-green-600 font-medium">‚úÖ Validated Coordinates</div>
                                <div class="font-mono text-sm text-gray-800">${location.lat.toFixed(5)}, ${location.lng.toFixed(5)}</div>
                            </div>
                            <div class="bg-gray-50 rounded p-2">
                                <div class="text-xs text-gray-500">Status</div>
                                <div class="text-sm font-medium text-green-600">Ready for Analysis</div>
                            </div>
                        </div>
                        <button onclick="zoomToLocation(${location.lat}, ${location.lng})" 
                                class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm w-full font-medium transition-all duration-200">
                            üîç Zoom to Location
                        </button>
                    </div>
                `;

                const popup = new mapboxgl.Popup({ 
                    offset: 15,
                    closeButton: true,
                    closeOnClick: false
                }).setHTML(popupHTML);
                
                const marker = new mapboxgl.Marker(el)
                    .setLngLat([location.lng, location.lat])
                    .setPopup(popup)
                    .addTo(map);
                
                markers.push(marker);
                bounds.extend([location.lng, location.lat]);
            });

            // Fit map to show all markers
            if (locationsData.length > 1) {
                map.fitBounds(bounds, { 
                    padding: 60,
                    maxZoom: 16
                });
            } else if (locationsData.length === 1) {
                map.flyTo({
                    center: [locationsData[0].lng, locationsData[0].lat],
                    zoom: 14,
                    duration: 1500
                });
            }
        }

        // Zoom to specific location
        function zoomToLocation(lat, lng) {
            map.flyTo({
                center: [lng, lat],
                zoom: 16,
                duration: 1500,
                essential: true
            });
        }

       // COMPLETE FIXED DOWNLOAD FUNCTIONALITY
        function downloadMap(format) {
            const downloadProgress = document.getElementById('downloadProgress');
            downloadProgress.classList.remove('hidden');
            
            // Show user-friendly message
            showMessage('üîÑ Preparing map for download...', 'info');
            
            if (format === 'pdf') {
                downloadMapAsPDF();
            } else if (format === 'png') {
                downloadMapAsPNG();
            } else if (format === 'svg') {
                downloadMapAsSVG();
            }
        }

        function downloadMapAsPDF() {
            const { jsPDF } = window.jspdf;
            
            // Wait for map to be fully loaded and rendered
            setTimeout(() => {
                // Capture the entire map container including all UI elements
                html2canvas(document.querySelector('.flex-1'), {
                    useCORS: true,
                    allowTaint: true,
                    scale: 1.5,
                    width: window.innerWidth,
                    height: window.innerHeight - 64, // Subtract header height
                    scrollX: 0,
                    scrollY: 0,
                    backgroundColor: '#f0f9ff',
                    logging: false,
                    onclone: function(clonedDoc) {
                        // Ensure all controls are visible in the clone
                        const controls = clonedDoc.querySelectorAll('.absolute');
                        controls.forEach(control => {
                            control.style.position = 'absolute';
                            control.style.zIndex = '1000';
                            control.style.display = 'block';
                        });
                        
                        // Make sure map canvas is visible
                        const mapCanvas = clonedDoc.querySelector('#map canvas');
                        if (mapCanvas) {
                            mapCanvas.style.display = 'block';
                        }
                    }
                }).then(canvas => {
                    const imgData = canvas.toDataURL('image/png', 1.0);
                    const pdf = new jsPDF('l', 'mm', 'a4');
                    
                    // Add title and header
                    pdf.setFontSize(20);
                    pdf.setTextColor(5, 150, 105); // Green color
                    pdf.text('Validated Locations Map', 20, 20);
                    
                    // Add subtitle
                    pdf.setFontSize(12);
                    pdf.setTextColor(75, 85, 99); // Gray color
                    pdf.text('HarmonAIze Geolocation Platform', 20, 30);
                    
                    // Calculate image dimensions to fit page
                    const pageWidth = pdf.internal.pageSize.getWidth();
                    const pageHeight = pdf.internal.pageSize.getHeight();
                    const imgWidth = pageWidth - 40; // 20mm margin on each side
                    const imgHeight = (canvas.height * imgWidth) / canvas.width;
                    
                    // Add map image
                    const yPosition = 40;
                    if (imgHeight > pageHeight - yPosition - 60) {
                        // If image is too tall, scale it down
                        const scaledHeight = pageHeight - yPosition - 60;
                        const scaledWidth = (canvas.width * scaledHeight) / canvas.height;
                        pdf.addImage(imgData, 'PNG', 20, yPosition, scaledWidth, scaledHeight);
                    } else {
                        pdf.addImage(imgData, 'PNG', 20, yPosition, imgWidth, imgHeight);
                    }
                    
                    // Add legend box
                    const legendY = Math.min(yPosition + imgHeight + 10, pageHeight - 50);
                    pdf.setDrawColor(34, 197, 94);
                    pdf.setFillColor(240, 249, 255);
                    pdf.rect(20, legendY - 5, 80, 25, 'FD');
                    
                    pdf.setFontSize(14);
                    pdf.setTextColor(34, 197, 94);
                    pdf.text('Legend', 25, legendY + 3);
                    
                    // Add legend items
                    pdf.setFontSize(10);
                    pdf.setTextColor(75, 85, 99);
                    pdf.setFillColor(16, 185, 129);
                    pdf.circle(27, legendY + 9, 1.5, 'F');
                    pdf.text('Validated Locations', 32, legendY + 10);
                    pdf.text('Confirmed coordinates ready for analysis', 32, legendY + 15);
                    
                    // Add footer with metadata
                    pdf.setFontSize(10);
                    pdf.setTextColor(107, 114, 128);
                    const footerY = pageHeight - 20;
                    pdf.text(`Generated: ${new Date().toLocaleString()}`, 20, footerY);
                    pdf.text(`Total Validated Locations: {{ total_locations }}`, 20, footerY + 5);
                    pdf.text('Source: HarmonAIze Geolocation Platform', 20, footerY + 10);
                    
                    // Save the PDF
                    pdf.save(`validated-locations-map-${new Date().toISOString().split('T')[0]}.pdf`);
                    
                    document.getElementById('downloadProgress').classList.add('hidden');
                    showMessage('‚úÖ PDF downloaded successfully with complete map, legend, and basemap!', 'success');
                }).catch(error => {
                    console.error('PDF generation failed:', error);
                    document.getElementById('downloadProgress').classList.add('hidden');
                    showMessage('‚ùå PDF generation failed. Please try again.', 'error');
                });
            }, 2000); // Wait 2 seconds for map to fully render
        }

        function downloadMapAsPNG() {
            // Wait for map to be fully loaded
            setTimeout(() => {
                html2canvas(document.querySelector('.flex-1'), {
                    useCORS: true,
                    allowTaint: true,
                    scale: 2,
                    width: window.innerWidth,
                    height: window.innerHeight - 64,
                    scrollX: 0,
                    scrollY: 0,
                    backgroundColor: '#f0f9ff',
                    logging: false,
                    onclone: function(clonedDoc) {
                        // Ensure all UI elements are visible
                        const controls = clonedDoc.querySelectorAll('.absolute');
                        controls.forEach(control => {
                            control.style.position = 'absolute';
                            control.style.zIndex = '1000';
                            control.style.display = 'block';
                        });
                        
                        // Make sure map is visible
                        const mapEl = clonedDoc.getElementById('map');
                        if (mapEl) {
                            mapEl.style.background = '#f0f9ff';
                            mapEl.style.display = 'block';
                        }
                    }
                }).then(canvas => {
                    // Create a new canvas with title and metadata
                    const finalCanvas = document.createElement('canvas');
                    const ctx = finalCanvas.getContext('2d');
                    
                    // Set canvas size with space for title and legend
                    finalCanvas.width = canvas.width;
                    finalCanvas.height = canvas.height + 120; // Extra space for title and footer
                    
                    // Fill background
                    ctx.fillStyle = '#f0f9ff';
                    ctx.fillRect(0, 0, finalCanvas.width, finalCanvas.height);
                    
                    // Add title
                    ctx.fillStyle = '#059669';
                    ctx.font = 'bold 32px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('Validated Locations Map', finalCanvas.width / 2, 50);
                    
                    // Add subtitle
                    ctx.fillStyle = '#6b7280';
                    ctx.font = '18px Arial';
                    ctx.fillText(`Generated: ${new Date().toLocaleDateString()} | Total: {{ total_locations }} locations`, finalCanvas.width / 2, 80);
                    
                    // Draw the map
                    ctx.drawImage(canvas, 0, 100);
                    
                    // Add legend at bottom
                    const legendY = canvas.height + 100;
                    ctx.fillStyle = '#10b981';
                    ctx.beginPath();
                    ctx.arc(50, legendY + 20, 8, 0, 2 * Math.PI);
                    ctx.fill();
                    
                    ctx.fillStyle = '#374151';
                    ctx.font = '16px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText('‚óè Validated Locations - Confirmed coordinates ready for analysis', 70, legendY + 25);
                    
                    // Create download link
                    const link = document.createElement('a');
                    link.download = `validated-locations-map-${new Date().toISOString().split('T')[0]}.png`;
                    link.href = finalCanvas.toDataURL('image/png');
                    link.click();
                    
                    document.getElementById('downloadProgress').classList.add('hidden');
                    showMessage('‚úÖ PNG downloaded successfully with complete map, title, and legend!', 'success');
                }).catch(error => {
                    console.error('PNG generation failed:', error);
                    document.getElementById('downloadProgress').classList.add('hidden');
                    showMessage('‚ùå PNG generation failed. Please try again.', 'error');
                });
            }, 2000);
        }

        function downloadMapAsSVG() {
            // Create comprehensive SVG with legend and all elements
            const svg = createComprehensiveSVGMap();
            const blob = new Blob([svg], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.download = `validated-locations-map-${new Date().toISOString().split('T')[0]}.svg`;
            link.href = url;
            link.click();
            
            URL.revokeObjectURL(url);
            document.getElementById('downloadProgress').classList.add('hidden');
            showMessage('‚úÖ SVG downloaded successfully with complete map structure!', 'success');
        }

        function createComprehensiveSVGMap() {
            const width = 1200;
            const height = 800;
            const margin = 60;
            
            let svg = `<svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg">`;
            
            // Background
            svg += `<rect width="${width}" height="${height}" fill="#f0f9ff"/>`;
            
            // Title
            svg += `<text x="${width/2}" y="40" font-family="Arial" font-size="24" font-weight="bold" text-anchor="middle" fill="#059669">Validated Locations Map</text>`;
            svg += `<text x="${width/2}" y="60" font-family="Arial" font-size="14" text-anchor="middle" fill="#6b7280">HarmonAIze Geolocation Platform</text>`;
            
            // Map area background
            svg += `<rect x="${margin}" y="80" width="${width - 2*margin}" height="${height - 200}" fill="#e5f3ff" stroke="#94a3b8" stroke-width="2" rx="8"/>`;
            
            // Add markers with proper positioning
            const mapWidth = width - 2*margin;
            const mapHeight = height - 200;
            
            if (locationsData.length > 0) {
                locationsData.forEach((location, index) => {
                    // Calculate position (simplified grid layout for SVG)
                    const cols = Math.ceil(Math.sqrt(locationsData.length));
                    const col = index % cols;
                    const row = Math.floor(index / cols);
                    
                    const x = margin + 50 + (col * (mapWidth - 100) / cols);
                    const y = 120 + (row * (mapHeight - 80) / Math.ceil(locationsData.length / cols));
                    
                    // Marker
                    svg += `<circle cx="${x}" cy="${y}" r="8" fill="#10b981" stroke="#22c55e" stroke-width="2"/>`;
                    
                    // Label
                    svg += `<text x="${x}" y="${y + 25}" font-family="Arial" font-size="10" text-anchor="middle" fill="#374151">${location.name}</text>`;
                });
            }
            
            // Legend
            const legendY = height - 120;
            svg += `<rect x="${margin}" y="${legendY}" width="300" height="60" fill="#ffffff" stroke="#d1d5db" stroke-width="1" rx="6"/>`;
            svg += `<text x="${margin + 15}" y="${legendY + 20}" font-family="Arial" font-size="16" font-weight="bold" fill="#374151">Legend</text>`;
            svg += `<circle cx="${margin + 25}" cy="${legendY + 35}" r="6" fill="#10b981" stroke="#22c55e" stroke-width="2"/>`;
            svg += `<text x="${margin + 40}" y="${legendY + 40}" font-family="Arial" font-size="12" fill="#374151">Validated Locations (${locationsData.length})</text>`;
            
            // Footer
            svg += `<text x="${margin}" y="${height - 20}" font-family="Arial" font-size="12" fill="#6b7280">Generated: ${new Date().toLocaleDateString()} | Source: HarmonAIze Platform</text>`;
            
            svg += '</svg>';
            
            return svg;
        }

        // Update map info
        function updateMapInfo() {
            const zoom = map.getZoom().toFixed(1);
            const center = map.getCenter();
            
            document.getElementById('currentZoom').textContent = zoom;
            document.getElementById('currentCenter').textContent = `${center.lat.toFixed(3)}, ${center.lng.toFixed(3)}`;
        }

        // Initialize map
        map.on('load', function() {
            addMarkersToMap();
            updateMapInfo();
        });

        map.on('zoom', updateMapInfo);
        map.on('move', updateMapInfo);

        function showMessage(message, type) {
            const container = document.getElementById('messageContainer');
            const colors = {
                'success': 'bg-green-100 text-green-800 border-green-300',
                'error': 'bg-red-100 text-red-800 border-red-300',
                'info': 'bg-blue-100 text-blue-800 border-blue-300'
            };
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `${colors[type]} border-2 px-6 py-4 rounded-xl shadow-lg backdrop-blur-sm max-w-md`;
            messageDiv.innerHTML = `
                <div class="flex items-center text-sm font-medium">
                    <span>${message}</span>
                </div>
            `;
            
            // Add entrance animation
            messageDiv.style.opacity = '0';
            messageDiv.style.transform = 'translateY(-20px)';
            container.appendChild(messageDiv);
            
            // Trigger animation
            setTimeout(() => {
                messageDiv.style.opacity = '1';
                messageDiv.style.transform = 'translateY(0)';
                messageDiv.style.transition = 'all 0.3s ease';
            }, 10);
            
            // Remove after delay
            setTimeout(() => {
                messageDiv.style.opacity = '0';
                messageDiv.style.transform = 'translateY(-20px)';
                setTimeout(() => messageDiv.remove(), 300);
            }, 5000);
        }

        // Show initial message
        setTimeout(() => {
            if (locationsData.length > 0) {
                showMessage(`üó∫Ô∏è Showing ${locationsData.length} validated locations. Click markers for details.`, 'info');
            }
        }, 1000);
    </script>
</body>
</html>